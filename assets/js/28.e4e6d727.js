(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{230:function(t,a,s){"use strict";s.r(a);var e=s(28),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("通过一个代理的场景梳理http-proxy-middleware的三个核心概念：")])]),t._v(" "),s("h3",{attrs:{id:"场景："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#场景："}},[t._v("#")]),t._v(" 场景：")]),t._v(" "),s("p",[t._v("我在使用ant-design-pro 这个模板中，我需要用到mock，也要请求后台数据；后台给我的接口地址都是http://www.example.org/ + security/violation/get_all_violation_info,root url后面的第一个单词并不唯一，没有api或者dev之类；而此时整个应用接口要么是根路径被和其他大部分接口是使用mock数据，mock接口是以/api开头如：/api/rule...，此时无法让后台改请求地址"),s("br")]),t._v(" "),s("h3",{attrs:{id:"要点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#要点"}},[t._v("#")]),t._v(" 要点:")]),t._v(" "),s("p",[t._v("通过组合使用中间件的"),s("strong",[t._v("context")]),t._v("和"),s("strong",[t._v("pathRewrite")]),t._v("概念，解决了我的问题")]),t._v(" "),s("h3",{attrs:{id:"解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[t._v("#")]),t._v(" 解决方案:")]),t._v(" "),s("p",[t._v("在所有需要请求的后台接口上加上/dev/+ security/violation/get_all_violation_info,然后代理/dev 这个"),s("strong",[t._v("context")]),t._v("，同时使用路径重写这个概念再"),s("strong",[t._v("pathRewrite")]),t._v("中配置{'^/dev':''},这样就完美解决了问题")]),t._v(" "),s("hr"),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/chimurai/http-proxy-middleware",target:"_blank",rel:"noopener noreferrer"}},[t._v("http-proxy-middleware github地址"),s("OutboundLink")],1)]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"core-concepts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#core-concepts"}},[t._v("#")]),t._v(" core Concepts:")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("概念")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("用法")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("实际意义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("context")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("'/api'")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("你要代理的目标请求的最前面的字段")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("target")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("target: 'http://www.example.org'")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("代理的目标地址：http://localhost:8000=>http://www.example.org")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("pathRewrite")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("pathRewrite: {'^/api' : ''}")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("将要代理的请求中的/api替换为''(空)")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("当前无论是vue项目还是react都通过webpack集成了该中间件他们用法如下：")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vue项目中的vue.config.js中：")]),t._v("\n    proxy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VUE_APP_BASE_API")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        target"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("http://www.example.org")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        changeOrigin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        pathRewrite"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VUE_APP_BASE_API")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// react项目的config文件或者是proxy文件中中")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      target"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://www.example.org'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      changeOrigin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      pathRewrite"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^/api'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);